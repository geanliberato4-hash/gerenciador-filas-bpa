<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Dados do Motorista • BPA</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/senha.css">
</head>

<body>

  <div class="background"></div>
  <div class="overlay"></div>

  <main class="container">

    <div class="card">

      <header class="card-header">
        <h1 id="tituloAtendimento"></h1>
        <p>Informe seus dados para gerar a senha</p>
      </header>

      <div class="card-body">
        <input id="nome" type="text" placeholder="Nome do motorista" class="input">
        <input id="placa" type="text" placeholder="Placa do veículo" class="input">

        <button class="btn-fila btn-gerar" onclick="gerarSenha()">
          Gerar senha
        </button>

        <div id="msg" class="msg" style="display:none;"></div>
      </div>

    </div>

    <footer class="footer">
      <span>Sistema de filas inteligente • BPA</span>
    </footer>

  </main>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

  <script src="js/config.js"></script>

  <script>
    const atendimento = localStorage.getItem("atendimentoKey");
    const titulo = document.getElementById("tituloAtendimento");
    const msg = document.getElementById("msg");

    if (!atendimento) {
      window.location.href = "senha.html";
    } else {
     titulo.innerText = localStorage.getItem("atendimentoNome");
    }

    function gerarSenha() {
      const nome = document.getElementById("nome").value.trim();
      const placa = document.getElementById("placa").value.trim();

      if (!nome || !placa) {
        mostrarMensagem("Preencha todos os campos");
        return;
      }

      const senha = {
        nome,
        placa,
        atendimento,
        status: "aguardando",
        criadoEm: Date.now()
      };

      db.ref(`unidades/${UNIDADE}/senhas`).push(senha).then(() => {
        mostrarMensagem("Senha gerada com sucesso");

        setTimeout(() => {
          localStorage.removeItem("atendimentoSelecionado");
          window.location.href = "senha.html";
        }, 1200);
      });
    }

    function mostrarMensagem(texto) {
      msg.innerText = texto;
      msg.style.display = "block";

      setTimeout(() => {
        msg.style.display = "none";
      }, 2000);
    }
  </script>

</body>
</html>
